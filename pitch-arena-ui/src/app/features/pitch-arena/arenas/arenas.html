<div class="space-y-4 m-4">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
    @for (arena of arenas; track arena) {
      <article
        class="rounded-2xl border p-4 md:p-5 transition hover:-translate-y-0.5"
        style="border-color: var(--color-border); background: var(--color-surface); box-shadow: var(--shadow-elev);">
        <div class="flex items-start gap-3">
          <!--todo boost-->
          <div
            class="h-32 w-32 rounded-xl grid place-items-center text-lg font-semibold border shrink-0"
            style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-surface) 88%, var(--color-text) 12%);">
            <img [src]="arena.image"/>
          </div>

          <div class="space-y-2 min-w-0">
            <div class="flex items-center justify-between gap-2">
              <h2 class="text-sm font-semibold truncate">{{ arena.name }}</h2>
              <span class="text-[11px] px-2 py-0.5 rounded-full border"
                    style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-muted) 10%, var(--color-surface));">
                {{ arena.path }}
              </span>
            </div>
            <p class="text-xs leading-snug" style="color: var(--color-muted);">
              {{ arena.description }}
            </p>
          </div>
        </div>

        <div class="flex items-center justify-between pt-3">
          <button
            class="text-[11px] px-3 py-1 rounded-full border transition hover:-translate-y-0.5"
            (click)="selectArena(arena)"
            style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-surface) 92%, var(--color-muted) 8%);">
            @if (selectedArena()?.path === arena.path) { Loaded } @else { Load arena }
          </button>
          @if (selectedArena()?.path === arena.path) {
            <span class="text-[11px] font-medium" style="color: var(--color-muted);">
              Showing details below
            </span>
          }
        </div>
      </article>
    }
  </div>

  @if (config(); as cfg) {
    <section
      class="rounded-2xl border p-4 md:p-5 space-y-4"
      style="border-color: var(--color-border); background: var(--color-surface); box-shadow: var(--shadow-elev);">
      <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-3">
        <div class="space-y-1">
          <p class="text-[11px] uppercase tracking-wide" style="color: var(--color-muted);">
            Selected arena
          </p>
          <div class="flex items-center gap-2">
            <h3 class="text-lg font-semibold leading-tight">{{ cfg.name }}</h3>
            <span class="text-[11px] px-2 py-0.5 rounded-full border"
                  style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-muted) 10%, var(--color-surface));">
              {{ cfg.id }}
            </span>
          </div>
          <p class="text-sm leading-snug" style="color: var(--color-muted);">
            {{ cfg.description || 'No description provided.' }}
          </p>
          @if(cfg.objective){
            <p class="text-sm leading-snug" style="color: var(--color-muted);">
              <strong>Thesis</strong>: {{cfg.objective.thesis}}
            </p>
            <div class="text-sm leading-snug" style="color: var(--color-muted);">
              <strong>Success Definition</strong>: 
              <ul>
                @for(line of cfg.objective.successDefinition; track line){
                  <li>{{line}}</li>
                }
              </ul>
            </div>
          }
        </div>

        @if (selectedArena()) {
          <div class="text-right text-xs space-y-0.5" style="color: var(--color-muted);">
            <div class="font-semibold text-sm" style="color: var(--color-text);">
              {{ selectedArena()?.name }}
            </div>
            <div>{{ selectedArena()?.path }}</div>
          </div>
        }
      </div>

      <div class="flex gap-4">
      <div>
        <ui-button-pill (onClick)="launchArena()">Launch the Arena</ui-button-pill>
      </div>

      <div>
        <ui-button-pill (onClick)="launchLab()">Test in Lab</ui-button-pill>
      </div>
      </div>


      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div class="border rounded-xl p-3 space-y-2"
             style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-surface) 94%, var(--color-muted) 6%);">
          <div class="flex items-center justify-between">
            <h4 class="text-sm font-semibold">Judges</h4>
            <span class="text-[11px] px-2 py-0.5 rounded-full border"
                  style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-muted) 10%, var(--color-surface));">
              {{ cfg.judges.length }}
            </span>
          </div>
          <ul class="space-y-2">
            @for (judge of cfg.judges; track judge.id) {
              <li class="flex items-start justify-between gap-2 rounded-lg p-2"
                  style="background: color-mix(in srgb, var(--color-surface) 90%, var(--color-muted) 10%);">
                <div class="space-y-0.5">
                  <p class="text-sm font-medium leading-tight">{{ judge.label }}</p>
                  <p class="text-[11px] leading-snug" style="color: var(--color-muted);">
                    {{ judge.dimension }}
                  </p>
                </div>
                @if (judge.tone) {
                  <span class="text-[11px] px-2 py-0.5 rounded-full border"
                        style="border-color: var(--color-border); background: var(--color-surface);">
                    {{ judge.tone }}
                  </span>
                }
              </li>
            }
          </ul>
        </div>

        @if (cfg.rubric) {
          <div class="border rounded-xl p-3 space-y-2"
               style="border-color: var(--color-border); background: color-mix(in srgb, var(--color-surface) 94%, var(--color-muted) 6%);">
            <h4 class="text-sm font-semibold">Rubric</h4>
            <p class="text-[11px]" style="color: var(--color-muted);">
              Scale {{ cfg.rubric.scale.min }}–{{ cfg.rubric.scale.max }} ({{ cfg.rubric.scale.decimals }} decimals)
            </p>
            <ul class="space-y-2">
              @for (item of cfg.rubric.criteriaWeights; track item.id) {
                <li class="flex items-center justify-between gap-2 rounded-lg p-2"
                    style="background: color-mix(in srgb, var(--color-surface) 92%, var(--color-muted) 8%);">
                  <div>
                    <p class="text-sm font-medium leading-tight">{{ item.label }}</p>
                    <p class="text-[11px]" style="color: var(--color-muted);">
                      {{ item.id }}
                    </p>
                  </div>
                  <span class="text-xs font-semibold">{{ item.weightPct }}%</span>
                </li>
              }
            </ul>

            @if (cfg.rubric.source) {
              <p class="text-[11px]" style="color: var(--color-muted);">
                Source: {{ cfg.rubric.source.name }} — {{ cfg.rubric.source.url }}
              </p>
            }
          </div>
        }
      </div>
    </section>
  }
</div>
